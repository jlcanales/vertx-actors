language: java
env:
  global:
    - GPG_EXECUTABLE=gpg
install: mvn install -DskipTests
before_install:
  - echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import
  - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust
after_success:
  - bash <(curl -s https://codecov.io/bash)
cache:
  directories:
    - $HOME/.m2
deploy:
  - provider: script
    script: mvn -X deploy --settings .travis/settings.xml -DskipTests=true -B -U -Prelease
    skip_cleanup: true
    on:
      repo: imrafaelmerino/vertx-actors
      tags: true
  - provider: releases
    skip_cleanup: true
    api_key: $GITHUB_TOKEN
    draft: true
    prerelease: true
    body: "Generated by TravisCI during the release process: build URL: $TRAVIS_BUILD_WEB_URL, build number: $TRAVIS_BUILD_NUMBER, commit: $TRAVIS_COMMIT, tag: $TRAVIS_TAG"
    name: Petra
    file:
      - target/JAVADOC.zip
      - docs/CHANGELOG.md
      - docs/README.md
      - target/SOURCES.zip
    on:
      repo: imrafaelmerino/vertx-actors
      tags: true
addons:
  sonarcloud:
    organization: "imrafaelmerino"

script:
  - mvn clean verify sonar:sonar -Pcoverage -Dsonar.projectKey=imrafaelmerino_vertx-actors
